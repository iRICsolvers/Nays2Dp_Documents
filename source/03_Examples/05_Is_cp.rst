[計算例 5] 実河川における準3次元流れの計算（複断面)
============================================================================

---------------
ソルバーの選択
---------------
メニュー画面で、「ファイル」「ソルバの選択」で表示される :numref:`05_koshi_1` 
で「Nays2d+」を選択して「OK」をクリックする。

.. _05_koshi_1:

.. figure:: images/05/koshi_1.png
   :width: 100%

   : ソルバーの選択

-----------------------------------------
河床高標高データ（横断データ）の読み込み
-----------------------------------------

:numref:`05_koshi_2` で「インポート」「河床高」を選択する。

.. _05_koshi_2:

.. figure:: images/05/koshi_2.png
   :width: 100%

   : 河床高ファイル(rivファイル)のインポート


:numref:`05_koshi_3` で、「compound.riv」を選択して[開く]。（compound.rivは、
https://i-ric.org/yasu/fw/rivfiles/compound.riv からダウンロードして
ローカルに保存しておくこと）。

.. _05_koshi_3:

.. figure:: images/05/koshi_3.png
   :width: 100%

   : ファイルの選択


:numref:`05_koshi_4` のように「問題が見つかりました」と出るが、構わず[OK]をクリックして
続ける。 

.. _05_koshi_4:

.. figure:: images/05/koshi_4.png
   :width: 60%

   : 見つかった問題

:numref:`05_koshi_5`  「河川測量データインポート設定」 のウィンドウで、
「左岸と右岸の中点」を選択して[OK]をクリック

.. _05_koshi_5:

.. figure:: images/05/koshi_5.png
   :width: 60%

   : 河川測量データインポート設定



:numref:`05_koshi_6` rivファイルのインポートが完了する。
なお、実際の河川のrivfileは横断測量断面そのままの場合、断面どうしの交差の回避や不要部分の
無効化など様々な編集が必要となるが、ここでは編集済みのもの用意してある。実際はそれぞれの
状況に応じた対応が必要となる。

.. _05_koshi_6:

.. figure:: images/05/koshi_6.png
   :width: 100%

   : インポート完了


-------------------------
中心線の移動
-------------------------

:numref:`05_koshi_7` に示すように、河道中心点を低水路の中央付近に移動させる。
なお、背景画像の表示方法については前章を参照されたい。

.. _05_koshi_7:

.. figure:: images/05/koshi_7.gif
   :width: 100%

   : 河道中心点の移動


-------------------------
格子の生成条件の設定
-------------------------

:numref:`05_koshi_80` のメニュー画面で、「格子」「格子生成アルゴリズムの選択」を選ぶ

.. _05_koshi_80:

.. figure:: images/05/koshi_80.png
   :width: 100%

   : 格子生成アルゴリズムの選択

:numref:`05_koshi_8` 「格子アルゴリズムの選択」画面で、「河川測量データから生成」を選んで[OK]をクリック

.. _05_koshi_8:

.. figure:: images/05/koshi_8.png
   :width: 100%

   : 河川測量データから生成

:numref:`05_koshi_9` 格子生成条件設定完了。各横断線の両端とセンターに青丸が表示された画面となる。

.. _05_koshi_9:

.. figure:: images/05/koshi_9.png
   :width: 100%

   : 格子生成条件設定終了

-------------------------
格子の生成
-------------------------

横断線のうちの一つ（どれでも良い）を選択し、左右岸どちらでも良いので右クリックして、
「分割点の追加(A)」を選択する。

.. _05_koshi_10:

.. figure:: images/05/koshi_10.png
   :width: 100%

   :分割点の追加(1)


「分割数」ここでは[8]（中央から半分の断面を8分割するという意味）を指定して[OK]をクリック。

.. _05_koshi_11:

.. figure:: images/05/koshi_11.png
   :width: 60%

   :分割点の追加(2)

:numref:`05_koshi_10` で選択したのと反対側の横断線を選んで、右クリックし、
「分割点の追加(A)」を選択する。

.. _05_koshi_12:

.. figure:: images/05/koshi_12.png
   :width: 100%

   :分割点の追加(3)

「分割数」ここでは[4] :numref:`05_koshi_11` で指定したのと同じく
左右岸対称の分割数とする。 

.. _05_koshi_13:

.. figure:: images/05/koshi_13.png
   :width: 60%

   :分割点の追加(4)


縦断方向の分割数は一括して指定する。メニューバーから「格子」「格子生成条件」
「分割点の一括追加」を選択

.. _05_koshi_14:

.. figure:: images/05/koshi_14.png
   :width: 100%

   :分割点の一括追加(1)

「目標とする分割点間の距離」を選び、ここでは[50]mを指定して、[OK]をクリック。


.. _05_koshi_15:

.. figure:: images/05/koshi_15.png
   :width: 60%

   :分割点の一括追加(2)


分割点の設定が完了。縦横断方向の分割点に黄色の〇が付いた平面図が表示される。

.. _05_koshi_16:

.. figure:: images/05/koshi_16.png
   :width: 100%

   :分割点の設定完了


メニューバーの「格子」「格子生成」を選ぶ。

.. _05_koshi_17:

.. figure:: images/05/koshi_17.png
   :width: 100%

   :格子生成(1)

格子生成範囲が青で塗られて、範囲の距離標を示すウィンドウが現れるので、確認して
[OK]をクリックする。

.. _05_koshi_18:

.. figure:: images/05/koshi_18.png
   :width: 100%

   :格子生成(2)

「マッピングを実行しますか？」と出るので[OK]をクリックする。

.. _05_koshi_19:

.. figure:: images/05/koshi_19.png
   :width: 60%

   :マッピングの実行確認

格子生成が完了し、格子が表示される。

.. _05_koshi_20:

.. figure:: images/05/koshi_20.png
   :width: 100%

   :格子生成の完了




オブジェクトブラウザーの「格子」「格子点の属性」「河床高(m)」に☑マークを入ると、
格子平面図に標高がカラーコンターで表示され、マッピングの結果が確認出来る。

.. _05_koshi_21:

.. figure:: images/05/koshi_21.png
   :width: 100%

   :マッピング結果の確認


------------------------
計算条件の設定
------------------------

メニューの「計算条件」「設定」を選ぶ

.. _05_joken_01:

.. figure:: images/05/joken_01.png
   :width: 100%

   :計算条件の設定

「グループ」「流量および下流端水位の設定」で、「流量を与える時間単位」を[時間]とし、
[Edit]をクリックする。

.. _05_joken_02:

.. figure:: images/05/joken_02.png
   :width: 100%

   :流量の設定(1)


:numref:`05_joken_03` で3時間の一定流量[2,000㎥/s]を設定して[OK]をクリックする。

.. _05_joken_03:

.. figure:: images/05/joken_03.png
   :width: 100%

   :流量の設定(2)

「時間および浸食に関するパラメーター」は下図ように設定する。

.. _05_joken_04:

.. figure:: images/05/joken_04.png
   :width: 100%

   :時間および浸食に関するパラメーター

「境界条件」は下図ように設定する。

.. _05_joken_05:

.. figure:: images/05/joken_05.png
   :width: 100%

   :境界条件

「水面形状」は下図ように設定する。

.. _05_joken_06:

.. figure:: images/05/joken_06.png
   :width: 100%

   :他の計算条

「他の計算条件」は下図ように設定する。

.. _05_joken_07:

.. figure:: images/05/joken_07.png
   :width: 100%

   :他の計算条

「3次元流速分布」に関しては下図のように設定して。[OK]を選択して終了

.. _05_joken_08:

.. figure:: images/05/joken_08.png
   :width: 100%

   :3次元流速分布の設定

-------------
計算の実行
-------------

メニューバーで、「計算」「実行」を選択

.. _05_jikko_01:

.. figure:: images/05/jikko_01.png
   :width: 100%

   :計算の実行(1)

「プロジェクトを保存しますか？」と聞かれるので、「はい(Y)」を選んで、適当な名前で
保存すると計算が開始される。

.. _05_jikko_03:

.. figure:: images/05/jikko_03.png
   :width: 100%

   :計算の実行(3)


「計算が終了しました。」と出るので、[OK]をクリックする。

.. _05_jikko_04:

.. figure:: images/05/jikko_04.png
   :width: 100%

   :計算の終了

---------------
計算結果の表示
---------------

メニューで「計算結果」「新しい可視化ウィンドウ(2D)を開く」を選択する。

.. _05_kekka_01:

.. figure:: images/05/kekka_01.png
   :width: 100%

   :新しい可視化ウィンドウ(2D)を開く


可視化ウィンドウが表示されるので、サイズを適当に変更して見やすい状態にする。

.. _05_kekka_02:

.. figure:: images/05/kekka_02.png
   :width: 100%

   :新しい可視化ウィンドウ(2D)の表示


^^^^^^^^^^^
水深の表示
^^^^^^^^^^^

:numref:`05_kekka_03` のように。オブジェクトブラウザーで、
「スカラー（格子点）」「Depth(m)」
に☑マークを入れて、[Depth(m)]を右クリックで「プロパティ」を選択すると、
「スカラー設定ウィンドウ」 :numref:`05_kekka_04` が表示される。

.. _05_kekka_03:

.. figure:: images/05/kekka_03.png
   :width: 100%

   :新しい可視化ウィンドウ(2D)の表示


.. _05_kekka_04:

.. figure:: images/05/kekka_04.png
   :width: 100%

   :スカラー設定

「スカラー設定ウィンドウ」 :numref:`05_kekka_05` を図のように設定して[OK]をクリックすると、
水深コンターが表示される。

.. _05_kekka_05:

.. figure:: images/05/kekka_05.png
   :width: 100%

   :水深コンター図

^^^^^^^^^^^^^^^
背景画像の表示
^^^^^^^^^^^^^^^

オブジェクトブラウザーで、「背景画像（インターネット）」「国土地理院（標準地図）」
に☑マークを入れると、背景地図が読み込まれ、表示される。

.. _05_haikei_05:

.. figure:: images/05/haikei_05.png
   :width: 100%

   :背景画像の読み込み完了

背景を写真にしたい場合や、他の種類の地図にしたい場合は、別の項目を☑する。
なお、GUIの操作時に常時背景画像を表示させておくと、操作が非常に重くなるので、
通常は「背景画像」の☑マークを外しておくことを推奨する。

^^^^^^^^^^^^^^^^^^^^
ベクトルと流線の表示
^^^^^^^^^^^^^^^^^^^^

操作方法、表示方法は全章の例と全く同じなので、省略する。

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
パーティクルアニメーションの表示
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

オブジェクトブラウザーの「パーティクル」「Velocity」に☑マークを付けて、
タイムバーをゼロに戻し、プレイボタンを押す（ :numref:`05_particle_01` )と
:numref:`05_particle_02` の水深平均流速によるパーティクルアニメーションが始まる。

.. _05_particle_01:

.. figure:: images/05/particle_01.png
   :width: 100%

   :パーティクルアニメーション


.. _05_particle_02:

.. figure:: images/05/particle_02.gif
   :width: 100%

   :水深平均流速によるパーティクル

表面流速に乗ったパーティクルを赤色で表示する。
「パーティクル」「SurfaceVelocity」に☑を入れて、「パーティクル」を右クリックして
「プロパティ」を選択すると、「パーティクル設定画面」 :numref:`05_particle_03` 
が表示されるので、図のように設定して[OK]をクリックする。
タイムバーをゼロに戻して、プレイボタンを押すと :numref:`05_particle_04` の
表面流によるパーティクルアニメーションが表示される。

.. _05_particle_03:

.. figure:: images/05/particle_03.png
   :width: 60%

   :パーティクル設定


.. _05_particle_04:

.. figure:: images/05/particle_04.gif
   :width: 100%

   :表面流速によるパーティクル

同様な手続きで、「BottomVelocity」を選択すると、底面流によるパーティクルを表示出来る。

.. _05_particle_05:

.. figure:: images/05/particle_05.gif
   :width: 100%

   :底面流速によるパーティクル
